<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <title>ルーレット</title>
  <link rel="stylesheet" href="roulette.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    let interval_id;
    let nums = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 15];
    let arrayIndex = null;

    function roulette_start() {
      if (arrayIndex !== null) {
        let div_ele = document.querySelectorAll('div');
        div_ele[nums[arrayIndex]].className = 'd-red';
        nums.splice(arrayIndex,1);
      }
      interval_id = setInterval(choose_at_random, 50);
    }

    function roulette_stop() {
      clearInterval(interval_id);
      let div_ele = document.querySelectorAll('div');
      div_ele[nums[arrayIndex]].classList.add('red');
      if (nums.length === 2) {
        $('#start').prop('disabled', true);
      }
      
    }

    function roulette_reset() {
      interval_id = 0;
      arrayIndex = null;
      nums = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 15];
      $('#start').prop('disabled', false);
      $('main').remove();
      let new_div = new Array;
      const new_main = document.createElement('main');
      $('section').before(new_main);
      for (let j = 0; j <= 15; j++) {
        new_div = document.createElement('div');
        new_div.textContent = j + 1;
        new_main.appendChild(new_div);
      }

    }

    function choose_at_random() {
      let div_ele = document.querySelectorAll('div');
      if (arrayIndex !== null) {
        div_ele[nums[arrayIndex]].classList.remove('red');
      }
      arrayIndex = Math.floor(Math.random() * (nums.length - 1));
      div_ele[nums[arrayIndex]].classList.add('red');
    }

    $(function() {
      const main_tag = document.querySelector('main');
      let div_element = [];

      for (let i = 0; i <= 15; i++) {
        div_element = document.createElement('div');
        div_element.textContent = i + 1;
        $('main').append(div_element);
      }

      $('#start').click(function() {
        roulette_start();
      });
      $('#stop').click(function() {
        roulette_stop();
      });
      $('#reset').click(function() {
        roulette_reset();
      });
    });
  </script>
</head>

<body>
  <main></main>
  <section id="container">
    <button class="btn" id="start" tabindex="-1" onclick="this.disabled = true;">スタート</button>
    <button class="btn" id="stop" tabindex="-1" onclick="getElementById('start').disabled = false">ストップ</button>
    <button class="btn" id="reset" tabindex="-1">リセット</button>
  </section>
</body>

</html>
